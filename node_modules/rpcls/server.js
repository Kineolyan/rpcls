var net = require('net');
var mgr = require('rpcls/manager');
var utils = require('rpcls/utils');

var getManagerId = utils.idGenerator();

var manager = new mgr.Manager(getManagerId());

var server = net.createServer(function(socket) {
  manager.registerClient(socket);
});

server.on('error', function(error) {
  console.log('[Error] %s', error);
});

server.on('listening', function() {
  console.info('server connected');
});

// Exports
exports.run = function(port) {
  server.listen(port);
};
